<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard IoT</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/" class="logo">ğŸ“Š Dashboard IoT</a>
            <ul class="nav-links">
                <li><a href="/index/">Valeurs</a></li>
                <li><a href="/download_csv/">Export CSV</a></li>
                <li><a href="/admin/">Admin</a></li>
                <li>
                    <button id="theme-toggle" class="theme-toggle-btn" onclick="toggleTheme()">
                        ğŸŒ™ Mode Sombre
                    </button>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="main-content">
            <!-- Live Measurements -->
            <div class="live-section">
                <div class="live-grid">
                    <div class="live-card">
                        <div class="live-icon">ğŸŒ¡ï¸</div>
                        <div class="live-value" id="current-temp">--</div>
                        <div class="live-label">TempÃ©rature (Â°C)</div>
                        <div class="live-time-info" id="last-update">Chargement...</div>
                        <a href="/graph_temp/" class="btn-graph-small">ğŸ“ˆ Voir Graphique</a>
                    </div>

                    <div class="live-card">
                        <div class="live-icon">ğŸ’§</div>
                        <div class="live-value" id="current-hum">--</div>
                        <div class="live-label">HumiditÃ© (%)</div>
                        <div class="live-time-info" id="last-update-hum">Chargement...</div>
                        <a href="/graph_hum/" class="btn-graph-small">ğŸ“ˆ Voir Graphique</a>
                    </div>

                    <!-- NEW: Manual Entry Card -->
                    <div class="live-card manual-entry-card">
                        <h3 class="live-label">Simulation</h3>
                        <div class="manual-entry-form">
                            <div class="input-group">
                                <label for="manual-temp">TempÃ©rature (Â°C):</label>
                                <input type="number" id="manual-temp" step="0.1" placeholder="Ex: 5.5" oninput="console.log('temp input:', this.value)">
                            </div>
                            <div class="input-group">
                                <label for="manual-hum">HumiditÃ© (%):</label>
                                <input type="number" id="manual-hum" step="0.1" placeholder="Ex: 65.0" oninput="console.log('hum input:', this.value)">
                            </div>
                            <button onclick="console.log('Button clicked'); submitManualData()" class="btn-submit-manual">
                                ğŸ“¤ Envoyer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Incidents -->
            <div class="incident-section">
                <h2 class="live-title">ğŸš¨ Gestion des Incidents</h2>

                <div id="incident-status" class="incident-status-ok">
                    âœ… Pas d'incidents
                </div>

                <div id="incident-details" class="incident-details-hidden">
                <div class="incident-counter-box">
                    <p class="incident-counter-text">
                        <strong>Compteur d'incidents:</strong>
                        <span id="incident-compteur" class="incident-compteur-value">0</span> / 9
                    </p>
                    <p class="incident-date-info">
                        <strong>Date de dÃ©but:</strong>
                        <span id="incident-date-debut">--</span>
                    </p>
                </div>

                <!-- OpÃ©ration 1 -->
                <div id="op1-container" class="operation-container op1-hidden">
                    <h3>ğŸ”§ OpÃ©ration Corrective 1</h3>
                    <div class="operation-content">
                        <label class="checkbox-label">
                            <input type="checkbox" id="op1-check">
                            OpÃ©ration effectuÃ©e
                        </label>
                        <div class="comment-section">
                            <label for="op1-comment">Commentaire obligatoire:</label>
                            <textarea id="op1-comment" rows="2" placeholder="DÃ©crivez l'opÃ©ration effectuÃ©e..."></textarea>
                        </div>
                        <button id="op1-btn" class="validate-btn" onclick="saveOperation(1)">
                            âœ“ Valider OpÃ©ration 1
                        </button>
                    </div>
                </div>

                <!-- OpÃ©ration 2 -->
                <div id="op2-container" class="operation-container op2-hidden">
                    <h3>ğŸ”§ OpÃ©ration Corrective 2</h3>
                    <div class="operation-content">
                        <label class="checkbox-label">
                            <input type="checkbox" id="op2-check">
                            OpÃ©ration effectuÃ©e
                        </label>
                        <div class="comment-section">
                            <label for="op2-comment">Commentaire obligatoire:</label>
                            <textarea id="op2-comment" rows="2" placeholder="DÃ©crivez l'opÃ©ration effectuÃ©e..."></textarea>
                        </div>
                        <button id="op2-btn" class="validate-btn" onclick="saveOperation(2)">
                            âœ“ Valider OpÃ©ration 2
                        </button>
                    </div>
                </div>

                <!-- OpÃ©ration 3 -->
                <div id="op3-container" class="operation-container op3-hidden">
                    <h3>ğŸ”§ OpÃ©ration Corrective 3</h3>
                    <div class="operation-content">
                        <label class="checkbox-label">
                            <input type="checkbox" id="op3-check">
                            OpÃ©ration effectuÃ©e
                        </label>
                        <div class="comment-section">
                            <label for="op3-comment">Commentaire obligatoire:</label>
                            <textarea id="op3-comment" rows="2" placeholder="DÃ©crivez l'opÃ©ration effectuÃ©e..."></textarea>
                        </div>
                        <button id="op3-btn" class="validate-btn" onclick="saveOperation(3)">
                            âœ“ Valider OpÃ©ration 3
                        </button>
                    </div>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <a href="/archive-incidents/" class="btn-archive">
                    ğŸ“‚ Voir Archive des Incidents
                </a>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-value" id="total-records">0</div>
                <div class="stat-label">Total Enregistrements</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">ğŸŒ¡ï¸</div>
                <div class="stat-value" id="avg-temp">--</div>
                <div class="stat-label">TempÃ©rature Moyenne</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">ğŸ’§</div>
                <div class="stat-value" id="avg-hum">--</div>
                <div class="stat-label">HumiditÃ© Moyenne</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">ğŸ”„</div>
                <div class="stat-value status-online" id="status">â— En ligne</div>
                <div class="stat-label">Ã‰tat du SystÃ¨me</div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="actions">
            <a href="/myChart/" class="btn-secondary">ğŸ“ˆ Voir Graphiques</a>
            <a href="/api/" class="btn-secondary" target="_blank">ğŸ”— API ComplÃ¨te</a>
            <a href="/download_csv/" class="btn-secondary">ğŸ’¾ TÃ©lÃ©charger CSV</a>
            <a href="/admin/" class="btn-secondary" target="_blank">âš™ï¸ Administration</a>
        </div>

        <!-- Footer -->
        <footer>
            <p style="color: #888;">SystÃ¨me de monitoring DHT11 en ligne</p>
        </footer>
    </div>

    <script>
        console.log('Page loaded, testing JavaScript...');
        // Test if elements exist
        setTimeout(() => {
            const tempInput = document.getElementById('manual-temp');
            const humInput = document.getElementById('manual-hum');
            console.log('manual-temp element:', tempInput);
            console.log('manual-hum element:', humInput);
            if (tempInput) {
                console.log('tempInput disabled:', tempInput.disabled);
                console.log('tempInput readonly:', tempInput.readOnly);
                // Force enable
                tempInput.disabled = false;
                tempInput.readOnly = false;
                humInput.disabled = false;
                humInput.readOnly = false;
                console.log('Forced inputs to be enabled');
            }
        }, 1000);
    </script>
    <script src="/static/js/dashboard.js"></script>
</body>
</html>